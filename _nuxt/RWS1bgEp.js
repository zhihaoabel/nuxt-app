const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./3LMrFN50.js","./cnz0qvgB.js"])))=>i.map(i=>d[i]);
import{b as t}from"./cnz0qvgB.js";import{c as e,a as n,t as o}from"./BRg0YUeL.js";function r(t,e){const o=function(t){const e=t.match(/FROM\s+(\w+)/);if(!e)return{};const o=n[function(t){return t.replace(/^_content_/,"")}(e[1])];return(null==o?void 0:o.fields)||{}}(t),r={...e};for(const n in r)"json"===o[n]&&r[n]&&"undefined"!==r[n]&&(r[n]=JSON.parse(r[n])),"boolean"===o[n]&&"undefined"!==r[n]&&(r[n]=Boolean(r[n]));for(const n in r)"NULL"===r[n]&&(r[n]=void 0);return r}let i;const a={},c={};function s(n){async function s(n){return i||(c._=c._||async function(){if(!i){const e=await t((()=>import("./3LMrFN50.js")),__vite__mapDeps([0,1]),import.meta.url).then((t=>t.default));globalThis.sqlite3ApiConfig={silent:!0,debug:(...t)=>console.debug(...t),warn:(...t)=>{String(t[0]).includes("OPFS sqlite3_vfs")||console.warn(...t)},error:(...t)=>console.error(...t),log:(...t)=>console.log(...t)};const n=await e();i=new n.oo1.DB}return i}(),i=await c._,Reflect.deleteProperty(c,"_")),a[String(n)]||(c[String(n)]=c[String(n)]||async function(t){if(window.sessionStorage.getItem("previewToken"))return i;let n=null;const r=`checksum_${t}`,a=`collection_${t}`;let c="matched";try{const n=i.exec({sql:`SELECT * FROM ${o.info} where id = '${r}'`,rowMode:"object",returnValue:"resultRows"}).shift();(null==n?void 0:n.version)!==e[String(t)]&&(c="mismatch")}catch{c="missing"}if("matched"!==c){window.localStorage.getItem(`content_${r}`)===e[String(t)]&&(n=window.localStorage.getItem(`content_${a}`));if(!n){n=await async function(t,n){return await $fetch(`/__nuxt_content/${n}/sql_dump`,{context:{},responseType:"text",headers:{"content-type":"text/plain"},query:{v:e[String(n)],t:void 0}})}(0,String(t));try{window.localStorage.setItem(`content_${r}`,e[String(t)]),window.localStorage.setItem(`content_${a}`,n)}catch(s){console.error("Database integrity check failed, rebuilding database",s)}}const l=await async function(t,e="gzip"){var n;const o=Uint8Array.from(atob(t),(t=>t.charCodeAt(0))),r=null==(n=new Response(new Blob([o])).body)?void 0:n.pipeThrough(new DecompressionStream(e));return(await new Response(r).text()).split("\n")}(n);await i.exec({sql:`DROP TABLE IF EXISTS ${o[String(t)]}`}),"mismatch"===c&&await i.exec({sql:`DELETE FROM ${o.info} WHERE id = '${r}'`});for(const t of l)try{await i.exec(t)}catch(s){console.error("Error executing command",s)}}return i}(n),await c[String(n)],a[String(n)]="loaded",Reflect.deleteProperty(c,String(n))),i}return{all:async(t,e)=>(await s(n),i.exec({sql:t,bind:e,rowMode:"object",returnValue:"resultRows"}).map((e=>r(t,e)))),first:async(t,e)=>(await s(n),r(t,i.exec({sql:t,bind:e,rowMode:"object",returnValue:"resultRows"}).shift())),exec:async(t,e)=>{await s(n),await i.exec({sql:t,bind:e})}}}export{s as loadDatabaseAdapter};
