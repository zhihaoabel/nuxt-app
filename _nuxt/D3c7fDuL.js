import{al as e,r as l,C as a,am as t,an as n,E as i,ao as u,ap as r,N as s,e as o,w as d,g as v,J as c,Q as p,aq as f,K as m,O as g,ar as h,as as y,at as b,P as x,au as k,U as K,y as I,a3 as A,ag as S,d as C,h as V,F as T,ac as w,n as _,ah as E,f as j,I as B,t as L}from"./cnz0qvgB.js";import{c as $}from"./BarjZPI0.js";import{t as M}from"./CT-dsyvG.js";import R from"./CtamgwS7.js";import{_ as W,M as q,a as z}from"./BbRql90R.js";import{u as O}from"./D3rw8bTH.js";import{u as P}from"./BBkmFPHu.js";import"./Dl1MLp5C.js";function F(l,a,t){const n=l.findIndex((l=>e(l,a))),i=l.findIndex((l=>e(l,t)));if(-1===n||-1===i)return[];const[u,r]=[n,i].sort(((e,l)=>e-l));return l.slice(u,r+1)}function N(e){return e.reduce(((e,l)=>(e.push(l),l.children&&e.push(...N(l.children)),e)),[])}const[U,D]=u("TreeRoot"),G=a({__name:"TreeRoot",props:{modelValue:{},defaultValue:{},items:{},expanded:{},defaultExpanded:{},getKey:{},getChildren:{type:Function,default:e=>e.children},selectionBehavior:{default:"toggle"},multiple:{},dir:{},disabled:{type:Boolean},propagateSelect:{type:Boolean},bubbleSelect:{type:Boolean},asChild:{type:Boolean},as:{default:"ul"}},emits:["update:modelValue","update:expanded"],setup(e,{emit:a}){const u=e,b=a,{items:x,multiple:k,disabled:K,propagateSelect:I,dir:A,bubbleSelect:S}=t(u),{handleTypeaheadSearch:C}=O(),V=P(A),T=l(),w=l(!1),_=r(),E=n(u,"modelValue",b,{defaultValue:u.defaultValue??(k.value?[]:void 0),passive:void 0===u.modelValue,deep:!0}),j=n(u,"expanded",b,{defaultValue:u.defaultExpanded??[],passive:void 0===u.expanded,deep:!0}),{onSelectItem:B,handleMultipleReplace:L}=function(e,a){const t=l();return{firstValue:t,onSelectItem:(l,n)=>{if(a.multiple&&Array.isArray(e.value))if("replace"===a.selectionBehavior)e.value=[l],t.value=l;else{const a=e.value.findIndex((e=>n(e)));e.value=-1!==a?e.value.filter(((e,l)=>l!==a)):[...e.value,l]}else"replace"===a.selectionBehavior?e.value={...l}:!Array.isArray(e.value)&&n(e.value)?e.value=void 0:e.value={...l};return e.value},handleMultipleReplace:function(l,n,i,u){var r;if(!(null==t?void 0:t.value)||!a.multiple||!Array.isArray(e.value))return;const s=null==(r=i().filter((e=>""!==e.ref.dataset.disabled)).find((e=>e.ref===n)))?void 0:r.value;if(!s)return;let o=null;switch(l){case"prev":case"next":o=F(u,t.value,s);break;case"first":o=F(u,t.value,null==u?void 0:u[0]);break;case"last":o=F(u,t.value,null==u?void 0:u[u.length-1])}e.value=o}}}(E,u),$=i((()=>k.value&&Array.isArray(E.value)?E.value.map((e=>u.getKey(e))):[u.getKey(E.value??{})]));function M(e,l=1,a){return e.reduce(((t,n,i)=>{const r=u.getKey(n),s=u.getChildren(n),o=j.value.includes(r),d={_id:r,value:n,index:i,level:l,parentItem:a,hasChildren:!!s,bind:{value:n,level:l,"aria-setsize":e.length,"aria-posinset":i+1}};return t.push(d),s&&o&&t.push(...M(s,l+1,n)),t}),[])}const R=i((()=>{const e=u.items;return j.value.map((e=>e)),M(e??[])}));function z(e){var l;if(w.value)_.trigger(e);else{const a=(null==(l=T.value)?void 0:l.getItems())??[];C(e.key,a)}}function U(e){if(w.value)return;const l=q[e.key];h((()=>{var e;L(l,y(),null==(e=T.value)?void 0:e.getItems,R.value.map((e=>e.value)))}))}function G(e){var l;if(null!=e.parentItem&&Array.isArray(E.value)&&u.multiple){const a=R.value.find((l=>null!=e.parentItem&&u.getKey(l.value)===u.getKey(e.parentItem)));if(null!=a){const e=null==(l=u.getChildren(a.value))?void 0:l.every((e=>E.value.find((l=>u.getKey(l)===u.getKey(e)))));E.value=e?[...E.value,a.value]:E.value.filter((e=>u.getKey(e)!==u.getKey(a.value))),G(a)}}}return D({modelValue:E,selectedKeys:$,onSelect:e=>{var l;const a=l=>u.getKey(l??{})===u.getKey(e),t=u.multiple&&Array.isArray(E.value)?-1!==(null==(l=E.value)?void 0:l.findIndex(a)):void 0;if(B(e,a),u.bubbleSelect&&u.multiple&&Array.isArray(E.value)){const l=R.value.find((l=>u.getKey(l.value)===u.getKey(e)));null!=l&&G(l)}if(u.propagateSelect&&u.multiple&&Array.isArray(E.value)){const l=N(u.getChildren(e)??[]);E.value=t?[...E.value].filter((e=>!l.some((l=>u.getKey(e??{})===u.getKey(l))))):[...E.value,...l]}},expanded:j,onToggle(e){if(!(e?u.getChildren(e):void 0))return;const l=u.getKey(e)??e;j.value.includes(l)?j.value=j.value.filter((e=>e!==l)):j.value.push(l)},getKey:u.getKey,getChildren:u.getChildren,items:x,expandedItems:R,disabled:K,multiple:k,dir:V,propagateSelect:I,bubbleSelect:S,isVirtual:w,virtualKeydownHook:_,handleMultipleReplace:L}),(e,l)=>(o(),s(c(W),{ref_key:"rovingFocusGroupRef",ref:T,"as-child":"",orientation:"vertical",dir:c(V)},{default:d((()=>[v(c(p),{role:"tree",as:e.as,"as-child":e.asChild,"aria-multiselectable":!!c(k)||void 0,onKeydown:[z,f(m(U,["shift"]),["up","down"])]},{default:d((()=>[g(e.$slots,"default",{flattenItems:R.value,modelValue:c(E),expanded:c(j)})])),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])])),_:3},8,["dir"]))}}),H=a({inheritAttrs:!1,__name:"TreeItem",props:{value:{},level:{},asChild:{type:Boolean},as:{default:"li"}},emits:["select","toggle"],setup(e,{expose:l,emit:a}){const t=e,n=a,u=U(),{getItems:r}=b(),h=i((()=>!!u.getChildren(t.value))),K=i((()=>{const e=u.getKey(t.value);return u.expanded.value.includes(e)})),I=i((()=>{const e=u.getKey(t.value);return u.selectedKeys.value.includes(e)})),A=i((()=>{if(u.bubbleSelect.value&&h.value&&Array.isArray(u.modelValue.value)){const e=N(u.getChildren(t.value)||[]);return e.some((e=>u.modelValue.value.find((l=>u.getKey(l)===u.getKey(e)))))&&!e.every((e=>u.modelValue.value.find((l=>u.getKey(l)===u.getKey(e)))))}if(u.propagateSelect.value&&I.value&&h.value&&Array.isArray(u.modelValue.value)){return!N(u.getChildren(t.value)||[]).every((e=>u.modelValue.value.find((l=>u.getKey(l)===u.getKey(e)))))}}));function S(e){if(h.value)if(K.value){const e=r().map((e=>e.ref)),l=y(),a=e.indexOf(l),n=[...e].slice(a).find((e=>Number(e.getAttribute("data-indent"))===t.level+1));n&&n.focus()}else _(e)}function C(e){if(K.value)_(e);else{const e=r().map((e=>e.ref)),l=y(),a=e.indexOf(l),n=[...e].slice(0,a).reverse().find((e=>Number(e.getAttribute("data-indent"))===t.level-1));n&&n.focus()}}async function V(e){n("select",e),(null==e?void 0:e.defaultPrevented)||u.onSelect(t.value)}async function T(e){n("toggle",e),(null==e?void 0:e.defaultPrevented)||u.onToggle(t.value)}async function w(e){if(!e)return;const l={originalEvent:e,value:t.value,isExpanded:K.value,isSelected:I.value};k("tree.select",V,l)}async function _(e){if(!e)return;const l={originalEvent:e,value:t.value,isExpanded:K.value,isSelected:I.value};k("tree.toggle",T,l)}return l({isExpanded:K,isSelected:I,isIndeterminate:A,handleToggle:()=>u.onToggle(t.value),handleSelect:()=>u.onSelect(t.value)}),(e,l)=>(o(),s(c(z),{"as-child":"",value:e.value,"allow-shift-key":""},{default:d((()=>[v(c(p),x(e.$attrs,{role:"treeitem",as:e.as,"as-child":e.asChild,"aria-selected":I.value,"aria-expanded":h.value?K.value:void 0,"aria-level":e.level,"data-indent":e.level,"data-selected":I.value?"":void 0,"data-expanded":K.value?"":void 0,onKeydown:[f(m(w,["self","prevent"]),["enter","space"]),l[0]||(l[0]=f(m((e=>"ltr"===c(u).dir.value?S(e):C(e)),["prevent"]),["right"])),l[1]||(l[1]=f(m((e=>"ltr"===c(u).dir.value?C(e):S(e)),["prevent"]),["left"]))],onClick:l[2]||(l[2]=m((e=>{w(e),_(e)}),["stop"]))}),{default:d((()=>[g(e.$slots,"default",{isExpanded:K.value,isSelected:I.value,isIndeterminate:A.value,handleSelect:()=>c(u).onSelect(e.value),handleToggle:()=>c(u).onToggle(e.value)})])),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])])),_:3},8,["value"]))}}),J={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},Q={__name:"CodeTree",props:{defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(e){const a=e,t=K(),n=I(),[u,r]=$(),p=i((()=>{var e,l;return M({extend:M(J),...(null==(l=null==(e=n.uiPro)?void 0:e.prose)?void 0:l.codeTree)||{}})()})),f=l(a.defaultValue?{path:a.defaultValue}:void 0),m=l(),g=l(1),h=i((()=>{var e,l;return g.value,(null==(l=null==(e=t.default)?void 0:e.call(t))?void 0:l.flatMap(b).filter(Boolean))||[]})),y=i((()=>function(e){const l=new Map,a=[];e.forEach((e=>{const t=e.label.split("/");let n="";t.forEach(((e,i)=>{var u,r;if(n=n?`${n}/${e}`:e,!l.has(n)){const s={label:e,path:n,...i<t.length-1&&{children:[]}};l.set(n,s),0===i?a.push(s):null==(r=null==(u=l.get(t.slice(0,i).join("/")))?void 0:u.children)||r.push(s)}}))}));const t=e=>e.sort(((e,l)=>!!e.children==!!l.children?e.label.localeCompare(l.label):l.children?1:-1)).map((e=>({...e,children:e.children&&t(e.children)})));return t(a)}(h.value)));function b(e,l){var a,t,n,i;return"symbol"==typeof e.type?null==(a=e.children)?void 0:a.map(b):{label:(null==(t=e.props)?void 0:t.filename)||(null==(n=e.props)?void 0:n.label)||`${l}`,icon:null==(i=e.props)?void 0:i.icon,component:e}}const x=i((()=>{var e;if(a.expandAll){const e=new Set;return h.value.forEach((l=>{const a=l.label.split("/");for(let t=1;t<a.length;t++)e.add(a.slice(0,t).join("/"))})),Array.from(e)}const l=null==(e=f.value)?void 0:e.path;if(!l)return[];const t=l.split("/");return t.map(((e,l)=>t.slice(0,l+1).join("/")))}));return A(f,(e=>{const l=h.value.find((l=>(null==e?void 0:e.path)===l.label));(null==l?void 0:l.component)&&(m.value=l)}),{immediate:!0}),S((()=>g.value++)),(e,l)=>{var t,i,g,h;const b=B;return o(),C(T,null,[v(c(u),null,{default:d((({items:e,level:l})=>[(o(!0),C(T,null,w(e,((e,t)=>{var i,u;return o(),C("li",{key:`${l}-${t}`,class:_(l>0?p.value.itemWithChildren({class:null==(i=a.ui)?void 0:i.itemWithChildren}):p.value.item({class:null==(u=a.ui)?void 0:u.item}))},[v(c(H),{"as-child":"",level:l,value:e},{default:d((({isExpanded:t,isSelected:i})=>{var u,d,f,m,g,h,y,x,k,K;return[V("button",{class:_(p.value.link({class:null==(u=a.ui)?void 0:u.link,active:i}))},[(null==(d=e.children)?void 0:d.length)?(o(),s(b,{key:0,name:t?c(n).ui.icons.folderOpen:c(n).ui.icons.folder,class:_(p.value.linkLeadingIcon({class:null==(f=a.ui)?void 0:f.linkLeadingIcon}))},null,8,["name","class"])):(o(),s(R,{key:1,filename:e.label,class:_(p.value.linkLeadingIcon({class:null==(m=a.ui)?void 0:m.linkLeadingIcon}))},null,8,["filename","class"])),V("span",{class:_(p.value.linkLabel({class:null==(g=a.ui)?void 0:g.linkLabel}))},L(e.label),3),(null==(h=e.children)?void 0:h.length)?(o(),C("span",{key:2,class:_(p.value.linkTrailing({class:null==(y=a.ui)?void 0:y.linkTrailing}))},[v(b,{name:c(n).ui.icons.chevronDown,class:_(p.value.linkTrailingIcon({class:null==(x=a.ui)?void 0:x.linkTrailingIcon}))},null,8,["name","class"])],2)):j("",!0)],2),(null==(k=e.children)?void 0:k.length)&&t?(o(),C("ul",{key:0,class:_(p.value.listWithChildren({class:null==(K=a.ui)?void 0:K.listWithChildren}))},[v(c(r),{items:e.children,level:l+1},null,8,["items","level"])],2)):j("",!0)]})),_:2},1032,["level","value"])],2)})),128))])),_:1}),V("div",{class:_(p.value.root({class:[null==(t=a.ui)?void 0:t.root,a.class]}))},[v(c(G),{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=e=>f.value=e),class:_(p.value.list({class:null==(i=a.ui)?void 0:i.list})),items:y.value,"get-key":e=>e.path,"default-expanded":x.value},{default:d((()=>[v(c(r),{items:y.value,level:0},null,8,["items"])])),_:1},8,["modelValue","class","items","get-key","default-expanded"]),V("div",{class:_(p.value.content({class:null==(g=a.ui)?void 0:g.content}))},[(o(),s(E(null==(h=m.value)?void 0:h.component)))],2)],2)],64)}}};export{Q as default};
