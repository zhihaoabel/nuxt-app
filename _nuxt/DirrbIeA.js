var t,e,i,s,n,r,o,a,p,l,h,c,d,u,f,g,y,m=Object.defineProperty,w=t=>{throw TypeError(t)},v=(t,e,i)=>((t,e,i)=>e in t?m(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i),b=(t,e,i)=>e.has(t)||w("Cannot "+i),_=(t,e,i)=>(b(t,e,"read from private field"),i?i.call(t):e.get(t)),x=(t,e,i)=>e.has(t)?w("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),E=(t,e,i,s)=>(b(t,e,"write to private field"),s?s.call(t,i):e.set(t,i),i),A=(t,e,i)=>(b(t,e,"access private method"),i);import{s as S,_ as T,u as j,a as P,r as R,o as M,b as $,c as O,d as k,e as C,f as N,g as L,n as W,F as I,h as B,w as z,T as V,t as H,i as U,j as X,k as q,l as D,m as F,p as K,q as Z,v as G,x as J,y as Y}from"./cnz0qvgB.js";import{loadDatabaseAdapter as Q}from"./RWS1bgEp.js";import{r as tt}from"./BRg0YUeL.js";const et=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],it=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],st=[];class nt{constructor(){v(this,"_data",new rt),v(this,"_hash",new rt([...et])),v(this,"_nDataBytes",0),v(this,"_minBufferSize",0)}finalize(t){t&&this._append(t);const e=8*this._nDataBytes,i=8*this._data.sigBytes;return this._data.words[i>>>5]|=128<<24-i%32,this._data.words[14+(i+64>>>9<<4)]=Math.floor(e/4294967296),this._data.words[15+(i+64>>>9<<4)]=e,this._data.sigBytes=4*this._data.words.length,this._process(),this._hash}_doProcessBlock(t,e){const i=this._hash.words;let s=i[0],n=i[1],r=i[2],o=i[3],a=i[4],p=i[5],l=i[6],h=i[7];for(let c=0;c<64;c++){if(c<16)st[c]=0|t[e+c];else{const t=st[c-15],e=(t<<25|t>>>7)^(t<<14|t>>>18)^t>>>3,i=st[c-2],s=(i<<15|i>>>17)^(i<<13|i>>>19)^i>>>10;st[c]=e+st[c-7]+s+st[c-16]}const i=s&n^s&r^n&r,d=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),u=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&p^~a&l)+it[c]+st[c];h=l,l=p,p=a,a=o+u|0,o=r,r=n,n=s,s=u+(d+i)|0}i[0]=i[0]+s|0,i[1]=i[1]+n|0,i[2]=i[2]+r|0,i[3]=i[3]+o|0,i[4]=i[4]+a|0,i[5]=i[5]+p|0,i[6]=i[6]+l|0,i[7]=i[7]+h|0}_append(t){"string"==typeof t&&(t=rt.fromUtf8(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(t){let e,i=this._data.sigBytes/64;i=t?Math.ceil(i):Math.max((0|i)-this._minBufferSize,0);const s=16*i,n=Math.min(4*s,this._data.sigBytes);if(s){for(let t=0;t<s;t+=16)this._doProcessBlock(this._data.words,t);e=this._data.words.splice(0,s),this._data.sigBytes-=n}return new rt(e,n)}}class rt{constructor(t,e){v(this,"words"),v(this,"sigBytes"),t=this.words=t||[],this.sigBytes=void 0===e?4*t.length:e}static fromUtf8(t){const e=unescape(encodeURIComponent(t)),i=e.length,s=[];for(let n=0;n<i;n++)s[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new rt(s,i)}toBase64(){const t=[];for(let e=0;e<this.sigBytes;e+=3){const i=(this.words[e>>>2]>>>24-e%4*8&255)<<16|(this.words[e+1>>>2]>>>24-(e+1)%4*8&255)<<8|this.words[e+2>>>2]>>>24-(e+2)%4*8&255;for(let s=0;s<4&&8*e+6*s<8*this.sigBytes;s++)t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(i>>>6*(3-s)&63))}return t.join("")}concat(t){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let e=0;e<t.sigBytes;e++){const i=t.words[e>>>2]>>>24-e%4*8&255;this.words[this.sigBytes+e>>>2]|=i<<24-(this.sigBytes+e)%4*8}else for(let e=0;e<t.sigBytes;e+=4)this.words[this.sigBytes+e>>>2]=t.words[e>>>2];this.sigBytes+=t.sigBytes}}function ot(t){return e=S(t),(new nt).finalize(e).toBase64();var e}const at={key:0},pt={key:0},lt={id:"__preview_loader"},ht=T({__name:"ContentPreviewMode",props:{previewToken:{type:String,required:!0},api:{type:String,required:!0},initializePreview:{type:Function,required:!0}},setup(t){const e=t,i=["__nuxt_preview","__preview_enabled"],s=j(),n=P(),r=R(!0),o=R(!1),a=R(!1),p=R("");let l;const h=async()=>{U("previewToken").value="",window.sessionStorage.removeItem("previewToken"),window.sessionStorage.removeItem("previewAPI"),await n.replace({query:{preview:void 0}}),window.location.reload()};return M((async()=>{const t=await $((()=>import("./ByEGEbBs.js")),[],import.meta.url);let r;l=t.connect(`${e.api}/preview`,{transports:["websocket","polling"],auth:{token:e.previewToken}}),l.on("connect",(()=>{r=setTimeout((()=>{a.value||(r=setTimeout((()=>{p.value="Preview sync timed out",a.value=!1}),3e4),l.emit("draft:requestSync"))}),3e4)}));const o=()=>{r&&(clearTimeout(r),r=null)};l.on("draft:sync",(async t=>{if(o(),t)(async t=>{await e.initializePreview(t),U("previewToken").value&&(a.value=!0,await n.replace({query:{}}),s.callHook("nuxt-content:preview:ready"),window.parent&&window.self!==window.parent&&l.disconnect())})(t);else try{l.once("draft:ready",(()=>{l.emit("draft:requestSync")})),await $fetch("api/projects/preview/sync",{baseURL:e.api,method:"POST",params:{token:e.previewToken}})}catch(i){if(o(),404===i.response.status)p.value="Preview draft not found",a.value=!1;else p.value="An error occurred while syncing preview",a.value=!1}})),l.on("draft:unauthorized",(()=>{o(),p.value="Unauthorized preview",a.value=!1})),l.on("disconnect",(()=>{o()})),document.body.classList.add(...i)})),O((()=>{document.body.classList.remove(...i)})),(t,e)=>(C(),k("div",null,[r.value?(C(),k("div",{key:0,id:"__nuxt_preview",class:W({__preview_ready:a.value,__preview_refreshing:o.value})},[a.value?(C(),k(I,{key:0},[e[0]||(e[0]=B("svg",{viewBox:"0 0 90 90",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[B("path",{d:"M50.0016 71.0999h29.2561c.9293.0001 1.8422-.241 2.6469-.6992.8047-.4582 1.4729-1.1173 1.9373-1.9109.4645-.7936.7088-1.6939.7083-2.6102-.0004-.9162-.2455-1.8163-.7106-2.6095L64.192 29.713c-.4644-.7934-1.1325-1.4523-1.937-1.9105-.8046-.4581-1.7173-.6993-2.6463-.6993-.9291 0-1.8418.2412-2.6463.6993-.8046.4582-1.4726 1.1171-1.937 1.9105l-5.0238 8.5861-9.8224-16.7898c-.4648-.7934-1.1332-1.4522-1.938-1.9102-.8047-.4581-1.7176-.6992-2.6468-.6992-.9292 0-1.842.2411-2.6468.6992-.8048.458-1.4731 1.1168-1.9379 1.9102L6.56062 63.2701c-.46512.7932-.71021 1.6933-.71061 2.6095-.00041.9163.24389 1.8166.70831 2.6102.46443.7936 1.1326 1.4527 1.93732 1.9109.80473.4582 1.71766.6993 2.64686.6992h18.3646c7.2763 0 12.6422-3.1516 16.3345-9.3002l8.9642-15.3081 4.8015-8.1925 14.4099 24.6083H54.8058l-4.8042 8.1925ZM29.2077 62.899l-12.8161-.0028L35.603 30.0869l9.5857 16.4047-6.418 10.9645c-2.4521 3.9894-5.2377 5.4429-9.563 5.4429Z",fill:"currentColor"})],-1)),e[1]||(e[1]=B("span",null,"Preview enabled",-1)),B("button",{onClick:h}," Close ")],64)):N("",!0)],2)):N("",!0),L(V,{name:"preview-loading"},{default:z((()=>[!r.value||a.value||p.value?N("",!0):(C(),k("div",at,[e[4]||(e[4]=B("div",{id:"__preview_background"},null,-1)),B("div",{id:"__preview_loader"},[e[2]||(e[2]=B("svg",{id:"__preview_loading_icon",width:"32",height:"32",viewBox:"0 0 24 24"},[B("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 0 0 4.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 0 1-15.357-2m15.357 2H15"})],-1)),e[3]||(e[3]=B("p",null,"Initializing the preview...",-1)),B("button",{onClick:h}," Cancel ")])]))])),_:1}),L(V,{name:"preview-loading"},{default:z((()=>[p.value?(C(),k("div",pt,[e[5]||(e[5]=B("div",{id:"__preview_background"},null,-1)),B("div",lt,[B("p",null,H(p.value),1),B("button",{onClick:h}," Exit preview ")])])):N("",!0)])),_:1})]))}},[["__scopeId","data-v-b1ec4e60"]]),ct=/^[A-Za-z]:\//;function dt(t=""){return t?t.replace(/\\/g,"/").replace(ct,(t=>t.toUpperCase())):t}const ut=/^[/\\]{2}/,ft=/^[/\\](?![/\\])|^[/\\]{2}(?!\.)|^[A-Za-z]:[/\\]/,gt=/^[A-Za-z]:$/,yt=/.(\.[^./]+|\.)$/,mt=/^[/\\]|^[a-zA-Z]:[/\\]/,wt=function(...t){let e="";for(const i of t)if(i)if(e.length>0){const t="/"===e[e.length-1],s="/"===i[0];e+=t&&s?i.slice(1):t||s?i:`/${i}`}else e+=i;return function(t){if(0===t.length)return".";const e=(t=dt(t)).match(ut),i=vt(t),s="/"===t[t.length-1];return 0===(t=function(t,e){let i="",s=0,n=-1,r=0,o=null;for(let a=0;a<=t.length;++a){if(a<t.length)o=t[a];else{if("/"===o)break;o="/"}if("/"===o){if(n===a-1||1===r);else if(2===r){if(i.length<2||2!==s||"."!==i[i.length-1]||"."!==i[i.length-2]){if(i.length>2){const t=i.lastIndexOf("/");-1===t?(i="",s=0):(i=i.slice(0,t),s=i.length-1-i.lastIndexOf("/")),n=a,r=0;continue}if(i.length>0){i="",s=0,n=a,r=0;continue}}e&&(i+=i.length>0?"/..":"..",s=2)}else i.length>0?i+=`/${t.slice(n+1,a)}`:i=t.slice(n+1,a),s=a-n-1;n=a,r=0}else"."===o&&-1!==r?++r:r=-1}return i}(t,!i)).length?i?"/":s?"./":".":(s&&(t+="/"),gt.test(t)&&(t+="/"),e?i?`//${t}`:`//./${t}`:i&&!vt(t)?`/${t}`:t)}(e)};const vt=function(t){return ft.test(t)},bt=function(t){const e=dt(t).replace(/\/$/,"").split("/").slice(0,-1);return 1===e.length&&gt.test(e[0])&&(e[0]+="/"),e.join("/")||(vt(t)?"/":".")},_t=function(t){var e,i;const s=(null==(i=null==(e=mt.exec(t))?void 0:e[0])?void 0:i.replace(/\\/g,"/"))||"",n=function(t,e){const i=dt(t).split("/");let s="";for(let n=i.length-1;n>=0;n--){const t=i[n];if(t){s=t;break}}return e&&s.endsWith(e)?s.slice(0,-e.length):s}(t),r=function(t){if(".."===t)return"";const e=yt.exec(dt(t));return e&&e[1]||""}(n);return{root:s,dir:bt(t),base:n,ext:r,name:n.slice(0,n.length-r.length)}},xt={appConfig:"app.config.ts",appConfigV4:"app/app.config.ts",nuxtConfig:"nuxt.config.ts"};function Et(t){return(null==t?void 0:t.startsWith("content/"))?t.split("/").slice(1).join("/"):X(t)}function At(t,e=!1){return t?e?q(t.replace(/\/\d+\./,"/")):X(t.replace(/^\d+\./,"")):t}function St(t){const e=Et(t);return wt(bt(e),_t(e).name)}const Tt=D(((t,e,i)=>{if(Array.isArray(t[e])&&Array.isArray(i))return t[e]=i,!0}));function jt(t,e){for(const i in t){const s=e[i];i in e||delete t[i],null!==s&&"object"==typeof s&&jt(t[i],e[i])}}function Pt(t,e){for(const i in e){const s=e[i];null!==s&&"object"==typeof s?Array.isArray(s)&&Array.isArray(t[i])?t[i]=s:(t[i]=t[i]||{},Pt(t[i],s)):t[i]=s}}function Rt(t){const[e,...i]=t.include.includes("*")?t.include.split("*"):["",t.include];return{fixed:e||"",dynamic:"*"+i.join("*")}}const Mt=(t,e,i)=>{const{fixed:s}=Rt(i);if(!t.parsed)return;const n=At(s||""),r=At((null==i?void 0:i.prefix)||"",!0),o=t.parsed._path.substring(n.length),a=wt(r,o),p={id:t.parsed._id,stem:t.parsed._stem,meta:{},extension:t.parsed._extension,path:a},l=e.schema.definitions[e.name].properties;return Object.keys(t.parsed).forEach((e=>{e in l?p[e]=t.parsed[e]:p.meta[e]=t.parsed[e]})),p};function $t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ot,kt,Ct,Nt;const Lt=$t(function(){if(Nt)return Ct;Nt=1;var t=function(){if(kt)return Ot;function t(t,s,n){t instanceof RegExp&&(t=e(t,n)),s instanceof RegExp&&(s=e(s,n));var r=i(t,s,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+t.length,r[1]),post:n.slice(r[1]+s.length)}}function e(t,e){var i=e.match(t);return i?i[0]:null}function i(t,e,i){var s,n,r,o,a,p=i.indexOf(t),l=i.indexOf(e,p+1),h=p;if(p>=0&&l>0){if(t===e)return[p,l];for(s=[],r=i.length;h>=0&&!a;)h==p?(s.push(h),p=i.indexOf(t,h+1)):1==s.length?a=[s.pop(),l]:((n=s.pop())<r&&(r=n,o=l),l=i.indexOf(e,h+1)),h=p<l&&p>=0?p:l;s.length&&(a=[r,o])}return a}return kt=1,Ot=t,t.range=i,Ot}();Ct=function(t){if(!t)return[];"{}"===t.substr(0,2)&&(t="\\{\\}"+t.substr(2));return u(function(t){return t.split("\\\\").join(e).split("\\{").join(i).split("\\}").join(s).split("\\,").join(n).split("\\.").join(r)}(t),!0).map(a)};var e="\0SLASH"+Math.random()+"\0",i="\0OPEN"+Math.random()+"\0",s="\0CLOSE"+Math.random()+"\0",n="\0COMMA"+Math.random()+"\0",r="\0PERIOD"+Math.random()+"\0";function o(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function a(t){return t.split(e).join("\\").split(i).join("{").split(s).join("}").split(n).join(",").split(r).join(".")}function p(e){if(!e)return[""];var i=[],s=t("{","}",e);if(!s)return e.split(",");var n=s.pre,r=s.body,o=s.post,a=n.split(",");a[a.length-1]+="{"+r+"}";var l=p(o);return o.length&&(a[a.length-1]+=l.shift(),a.push.apply(a,l)),i.push.apply(i,a),i}function l(t){return"{"+t+"}"}function h(t){return/^-?0\d/.test(t)}function c(t,e){return t<=e}function d(t,e){return t>=e}function u(e,i){var n=[],r=t("{","}",e);if(!r)return[e];var a=r.pre,f=r.post.length?u(r.post,!1):[""];if(/\$$/.test(r.pre))for(var g=0;g<f.length;g++){var y=a+"{"+r.body+"}"+f[g];n.push(y)}else{var m,w,v=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),b=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),_=v||b,x=r.body.indexOf(",")>=0;if(!_&&!x)return r.post.match(/,.*\}/)?u(e=r.pre+"{"+r.body+s+r.post):[e];if(_)m=r.body.split(/\.\./);else if(1===(m=p(r.body)).length&&1===(m=u(m[0],!1).map(l)).length)return f.map((function(t){return r.pre+m[0]+t}));if(_){var E=o(m[0]),A=o(m[1]),S=Math.max(m[0].length,m[1].length),T=3==m.length?Math.abs(o(m[2])):1,j=c;A<E&&(T*=-1,j=d);var P=m.some(h);w=[];for(var R=E;j(R,A);R+=T){var M;if(b)"\\"===(M=String.fromCharCode(R))&&(M="");else if(M=String(R),P){var $=S-M.length;if($>0){var O=new Array($+1).join("0");M=R<0?"-"+O+M.slice(1):O+M}}w.push(M)}}else{w=[];for(var k=0;k<m.length;k++)w.push.apply(w,u(m[k],!1))}for(k=0;k<w.length;k++)for(g=0;g<f.length;g++){y=a+w[k]+f[g];(!i||_||y)&&n.push(y)}}return n}return Ct}()),Wt=t=>{if("string"!=typeof t)throw new TypeError("invalid pattern");if(t.length>65536)throw new TypeError("pattern is too long")},It={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Bt=t=>t.replace(/[[\]\\-]/g,"\\$&"),zt=t=>t.join(""),Vt=(t,e)=>{const i=e;if("["!==t.charAt(i))throw new Error("not in a brace expression");const s=[],n=[];let r=i+1,o=!1,a=!1,p=!1,l=!1,h=i,c="";t:for(;r<t.length;){const e=t.charAt(r);if("!"!==e&&"^"!==e||r!==i+1){if("]"===e&&o&&!p){h=r+1;break}if(o=!0,"\\"!==e||p){if("["===e&&!p)for(const[e,[o,p,l]]of Object.entries(It))if(t.startsWith(e,r)){if(c)return["$.",!1,t.length-i,!0];r+=e.length,l?n.push(o):s.push(o),a=a||p;continue t}p=!1,c?(e>c?s.push(Bt(c)+"-"+Bt(e)):e===c&&s.push(Bt(e)),c="",r++):t.startsWith("-]",r+1)?(s.push(Bt(e+"-")),r+=2):t.startsWith("-",r+1)?(c=e,r+=2):(s.push(Bt(e)),r++)}else p=!0,r++}else l=!0,r++}if(h<r)return["",!1,0,!1];if(!s.length&&!n.length)return["$.",!1,t.length-i,!0];if(0===n.length&&1===s.length&&/^\\?.$/.test(s[0])&&!l){const t=2===s[0].length?s[0].slice(-1):s[0];return[(d=t,d.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,h-i,!1]}var d;const u="["+(l?"^":"")+zt(s)+"]",f="["+(l?"":"^")+zt(n)+"]";return[s.length&&n.length?"("+u+"|"+f+")":s.length?u:f,a,h-i,!0]},Ht=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/\[([^\/\\])\]/g,"$1"):t.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),Ut=new Set(["!","?","+","*","@"]),Xt=t=>Ut.has(t),qt="(?!\\.)",Dt=new Set(["[","."]),Ft=new Set(["..","."]),Kt=new Set("().*{}+?[]^$\\!"),Zt="[^/]",Gt=Zt+"*?",Jt=Zt+"+?",Yt=class m{constructor(d,u,f={}){x(this,c),v(this,"type"),x(this,t),x(this,e),x(this,i,!1),x(this,s,[]),x(this,n),x(this,r),x(this,o),x(this,a,!1),x(this,p),x(this,l),x(this,h,!1),this.type=d,d&&E(this,e,!0),E(this,n,u),E(this,t,_(this,n)?_(_(this,n),t):this),E(this,p,_(this,t)===this?f:_(_(this,t),p)),E(this,o,_(this,t)===this?[]:_(_(this,t),o)),"!"!==d||_(_(this,t),a)||_(this,o).push(this),E(this,r,_(this,n)?_(_(this,n),s).length:0)}get hasMagic(){if(void 0!==_(this,e))return _(this,e);for(const t of _(this,s))if("string"!=typeof t&&(t.type||t.hasMagic))return E(this,e,!0);return _(this,e)}toString(){return void 0!==_(this,l)?_(this,l):this.type?E(this,l,this.type+"("+_(this,s).map((t=>String(t))).join("|")+")"):E(this,l,_(this,s).map((t=>String(t))).join(""))}push(...t){for(const e of t)if(""!==e){if("string"!=typeof e&&!(e instanceof m&&_(e,n)===this))throw new Error("invalid part: "+e);_(this,s).push(e)}}toJSON(){var e;const i=null===this.type?_(this,s).slice().map((t=>"string"==typeof t?t:t.toJSON())):[this.type,..._(this,s).map((t=>t.toJSON()))];return this.isStart()&&!this.type&&i.unshift([]),this.isEnd()&&(this===_(this,t)||_(_(this,t),a)&&"!"===(null==(e=_(this,n))?void 0:e.type))&&i.push({}),i}isStart(){var e;if(_(this,t)===this)return!0;if(!(null==(e=_(this,n))?void 0:e.isStart()))return!1;if(0===_(this,r))return!0;const i=_(this,n);for(let t=0;t<_(this,r);t++){const e=_(i,s)[t];if(!(e instanceof m&&"!"===e.type))return!1}return!0}isEnd(){var e,i,o;if(_(this,t)===this)return!0;if("!"===(null==(e=_(this,n))?void 0:e.type))return!0;if(!(null==(i=_(this,n))?void 0:i.isEnd()))return!1;if(!this.type)return null==(o=_(this,n))?void 0:o.isEnd();const a=_(this,n)?_(_(this,n),s).length:0;return _(this,r)===a-1}copyIn(t){"string"==typeof t?this.push(t):this.push(t.clone(this))}clone(t){const e=new m(this.type,t);for(const i of _(this,s))e.copyIn(i);return e}static fromGlob(t,e={}){var i;const s=new m(null,void 0,e);return A(i=m,u,f).call(i,t,s,0,e),s}toMMPattern(){if(this!==_(this,t))return _(this,t).toMMPattern();const i=this.toString(),[s,n,r,o]=this.toRegExpSource();if(!(r||_(this,e)||_(this,p).nocase&&!_(this,p).nocaseMagicOnly&&i.toUpperCase()!==i.toLowerCase()))return n;const a=(_(this,p).nocase?"i":"")+(o?"u":"");return Object.assign(new RegExp(`^${s}$`,a),{_src:s,_glob:i})}get options(){return _(this,p)}toRegExpSource(r){var o;const l=r??!!_(this,p).dot;if(_(this,t)===this&&A(this,c,d).call(this),!this.type){const p=this.isStart()&&this.isEnd(),h=_(this,s).map((t=>{var s;const[n,o,a,l]="string"==typeof t?A(s=m,u,y).call(s,t,_(this,e),p):t.toRegExpSource(r);return E(this,e,_(this,e)||a),E(this,i,_(this,i)||l),n})).join("");let c="";if(this.isStart()&&"string"==typeof _(this,s)[0]){if(!(1===_(this,s).length&&Ft.has(_(this,s)[0]))){const t=Dt,e=l&&t.has(h.charAt(0))||h.startsWith("\\.")&&t.has(h.charAt(2))||h.startsWith("\\.\\.")&&t.has(h.charAt(4)),i=!l&&!r&&t.has(h.charAt(0));c=e?"(?!(?:^|/)\\.\\.?(?:$|/))":i?qt:""}}let d="";this.isEnd()&&_(_(this,t),a)&&"!"===(null==(o=_(this,n))?void 0:o.type)&&(d="(?:$|\\/)");return[c+h+d,Ht(h),E(this,e,!!_(this,e)),_(this,i)]}const f="*"===this.type||"+"===this.type,w="!"===this.type?"(?:(?!(?:":"(?:";let v=A(this,c,g).call(this,l);if(this.isStart()&&this.isEnd()&&!v&&"!"!==this.type){const t=this.toString();return E(this,s,[t]),this.type=null,E(this,e,void 0),[t,Ht(this.toString()),!1,!1]}let b=!f||r||l?"":A(this,c,g).call(this,!0);b===v&&(b=""),b&&(v=`(?:${v})(?:${b})*?`);let x="";if("!"===this.type&&_(this,h))x=(this.isStart()&&!l?qt:"")+Jt;else{x=w+v+("!"===this.type?"))"+(!this.isStart()||l||r?"":qt)+Gt+")":"@"===this.type?")":"?"===this.type?")?":"+"===this.type&&b?")":"*"===this.type&&b?")?":`)${this.type}`)}return[x,Ht(v),E(this,e,!!_(this,e)),_(this,i)]}};t=new WeakMap,e=new WeakMap,i=new WeakMap,s=new WeakMap,n=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,p=new WeakMap,l=new WeakMap,h=new WeakMap,c=new WeakSet,d=function(){if(this!==_(this,t))throw new Error("should only call on root");if(_(this,a))return this;let e;for(this.toString(),E(this,a,!0);e=_(this,o).pop();){if("!"!==e.type)continue;let t=e,i=_(t,n);for(;i;){for(let n=_(t,r)+1;!i.type&&n<_(i,s).length;n++)for(const t of _(e,s)){if("string"==typeof t)throw new Error("string part in extglob AST??");t.copyIn(_(i,s)[n])}t=i,i=_(t,n)}}return this},u=new WeakSet,f=function(t,i,n,r){var o,a;let p=!1,l=!1,c=-1,d=!1;if(null===i.type){let e=n,s="";for(;e<t.length;){const n=t.charAt(e++);if(p||"\\"===n)p=!p,s+=n;else if(l)e===c+1?"^"!==n&&"!"!==n||(d=!0):"]"!==n||e===c+2&&d||(l=!1),s+=n;else if("["!==n)if(r.noext||!Xt(n)||"("!==t.charAt(e))s+=n;else{i.push(s),s="";const a=new Yt(n,i);e=A(o=Yt,u,f).call(o,t,a,e,r),i.push(a)}else l=!0,c=e,d=!1,s+=n}return i.push(s),e}let g=n+1,y=new Yt(null,i);const m=[];let w="";for(;g<t.length;){const e=t.charAt(g++);if(p||"\\"===e)p=!p,w+=e;else if(l)g===c+1?"^"!==e&&"!"!==e||(d=!0):"]"!==e||g===c+2&&d||(l=!1),w+=e;else if("["!==e)if(Xt(e)&&"("===t.charAt(g)){y.push(w),w="";const i=new Yt(e,y);y.push(i),g=A(a=Yt,u,f).call(a,t,i,g,r)}else if("|"!==e){if(")"===e)return""===w&&0===_(i,s).length&&E(i,h,!0),y.push(w),w="",i.push(...m,y),g;w+=e}else y.push(w),w="",m.push(y),y=new Yt(null,i);else l=!0,c=g,d=!1,w+=e}return i.type=null,E(i,e,void 0),E(i,s,[t.substring(n-1)]),g},g=function(t){return _(this,s).map((e=>{if("string"==typeof e)throw new Error("string type in extglob ast??");const[s,n,r,o]=e.toRegExpSource(t);return E(this,i,_(this,i)||o),s})).filter((t=>!(this.isStart()&&this.isEnd()&&!t))).join("|")},y=function(t,e,i=!1){let s=!1,n="",r=!1;for(let o=0;o<t.length;o++){const a=t.charAt(o);if(s)s=!1,n+=(Kt.has(a)?"\\":"")+a;else if("\\"!==a){if("["===a){const[i,s,a,p]=Vt(t,o);if(a){n+=i,r=r||s,o+=a-1,e=e||p;continue}}"*"!==a?"?"!==a?n+=a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):(n+=Zt,e=!0):(n+=i&&"*"===t?Jt:Gt,e=!0)}else o===t.length-1?n+="\\\\":s=!0}return[n,Ht(t),!!e,r]},x(Yt,u);let Qt=Yt;var te={};const ee=(t,e,i={})=>(Wt(e),!(!i.nocomment&&"#"===e.charAt(0))&&new je(e,i).match(t)),ie=/^\*+([^+@!?\*\[\(]*)$/,se=t=>e=>!e.startsWith(".")&&e.endsWith(t),ne=t=>e=>e.endsWith(t),re=t=>(t=t.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(t)),oe=t=>(t=t.toLowerCase(),e=>e.toLowerCase().endsWith(t)),ae=/^\*+\.\*+$/,pe=t=>!t.startsWith(".")&&t.includes("."),le=t=>"."!==t&&".."!==t&&t.includes("."),he=/^\.\*+$/,ce=t=>"."!==t&&".."!==t&&t.startsWith("."),de=/^\*+$/,ue=t=>0!==t.length&&!t.startsWith("."),fe=t=>0!==t.length&&"."!==t&&".."!==t,ge=/^\?+([^+@!?\*\[\(]*)?$/,ye=([t,e=""])=>{const i=be([t]);return e?(e=e.toLowerCase(),t=>i(t)&&t.toLowerCase().endsWith(e)):i},me=([t,e=""])=>{const i=_e([t]);return e?(e=e.toLowerCase(),t=>i(t)&&t.toLowerCase().endsWith(e)):i},we=([t,e=""])=>{const i=_e([t]);return e?t=>i(t)&&t.endsWith(e):i},ve=([t,e=""])=>{const i=be([t]);return e?t=>i(t)&&t.endsWith(e):i},be=([t])=>{const e=t.length;return t=>t.length===e&&!t.startsWith(".")},_e=([t])=>{const e=t.length;return t=>t.length===e&&"."!==t&&".."!==t},xe="object"==typeof process&&process?te&&te.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix";ee.sep="win32"===xe?{sep:"\\"}.sep:{sep:"/"}.sep;const Ee=Symbol("globstar **");ee.GLOBSTAR=Ee;ee.filter=(t,e={})=>i=>ee(i,t,e);const Ae=(t,e={})=>Object.assign({},t,e);ee.defaults=t=>{if(!t||"object"!=typeof t||!Object.keys(t).length)return ee;const e=ee;return Object.assign(((i,s,n={})=>e(i,s,Ae(t,n))),{Minimatch:class extends e.Minimatch{constructor(e,i={}){super(e,Ae(t,i))}static defaults(i){return e.defaults(Ae(t,i)).Minimatch}},AST:class extends e.AST{constructor(e,i,s={}){super(e,i,Ae(t,s))}static fromGlob(i,s={}){return e.AST.fromGlob(i,Ae(t,s))}},unescape:(i,s={})=>e.unescape(i,Ae(t,s)),escape:(i,s={})=>e.escape(i,Ae(t,s)),filter:(i,s={})=>e.filter(i,Ae(t,s)),defaults:i=>e.defaults(Ae(t,i)),makeRe:(i,s={})=>e.makeRe(i,Ae(t,s)),braceExpand:(i,s={})=>e.braceExpand(i,Ae(t,s)),match:(i,s,n={})=>e.match(i,s,Ae(t,n)),sep:e.sep,GLOBSTAR:Ee})};const Se=(t,e={})=>(Wt(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:Lt(t));ee.braceExpand=Se;ee.makeRe=(t,e={})=>new je(t,e).makeRe();ee.match=(t,e,i={})=>{const s=new je(e,i);return t=t.filter((t=>s.match(t))),s.options.nonull&&!t.length&&t.push(e),t};const Te=/[?*]|[+@!]\(.*?\)|\[|\]/;class je{constructor(t,e={}){v(this,"options"),v(this,"set"),v(this,"pattern"),v(this,"windowsPathsNoEscape"),v(this,"nonegate"),v(this,"negate"),v(this,"comment"),v(this,"empty"),v(this,"preserveMultipleSlashes"),v(this,"partial"),v(this,"globSet"),v(this,"globParts"),v(this,"nocase"),v(this,"isWindows"),v(this,"platform"),v(this,"windowsNoMagicRoot"),v(this,"regexp"),Wt(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||xe,this.isWindows="win32"===this.platform,this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||!1===e.allowWindowsEscape,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=void 0!==e.windowsNoMagicRoot?e.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const t of this.set)for(const e of t)if("string"!=typeof e)return!0;return!1}debug(...t){}make(){const t=this.pattern,e=this.options;if(!e.nocomment&&"#"===t.charAt(0))return void(this.comment=!0);if(!t)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...t)=>console.error(...t)),this.debug(this.pattern,this.globSet);const i=this.globSet.map((t=>this.slashSplit(t)));this.globParts=this.preprocess(i),this.debug(this.pattern,this.globParts);let s=this.globParts.map(((t,e,i)=>{if(this.isWindows&&this.windowsNoMagicRoot){const e=!(""!==t[0]||""!==t[1]||"?"!==t[2]&&Te.test(t[2])||Te.test(t[3])),i=/^[a-z]:/i.test(t[0]);if(e)return[...t.slice(0,4),...t.slice(4).map((t=>this.parse(t)))];if(i)return[t[0],...t.slice(1).map((t=>this.parse(t)))]}return t.map((t=>this.parse(t)))}));if(this.debug(this.pattern,s),this.set=s.filter((t=>-1===t.indexOf(!1))),this.isWindows)for(let n=0;n<this.set.length;n++){const t=this.set[n];""===t[0]&&""===t[1]&&"?"===this.globParts[n][2]&&"string"==typeof t[3]&&/^[a-z]:$/i.test(t[3])&&(t[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let i=0;i<t.length;i++)for(let e=0;e<t[i].length;e++)"**"===t[i][e]&&(t[i][e]="*");const{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):t=e>=1?this.levelOneOptimize(t):this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map((t=>{let e=-1;for(;-1!==(e=t.indexOf("**",e+1));){let i=e;for(;"**"===t[i+1];)i++;i!==e&&t.splice(e,i-e)}return t}))}levelOneOptimize(t){return t.map((t=>0===(t=t.reduce(((t,e)=>{const i=t[t.length-1];return"**"===e&&"**"===i?t:".."===e&&i&&".."!==i&&"."!==i&&"**"!==i?(t.pop(),t):(t.push(e),t)}),[])).length?[""]:t))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let i=1;i<t.length-1;i++){const s=t[i];1===i&&""===s&&""===t[0]||("."!==s&&""!==s||(e=!0,t.splice(i,1),i--))}"."!==t[0]||2!==t.length||"."!==t[1]&&""!==t[1]||(e=!0,t.pop())}let i=0;for(;-1!==(i=t.indexOf("..",i+1));){const s=t[i-1];s&&"."!==s&&".."!==s&&"**"!==s&&(e=!0,t.splice(i-1,2),i-=2)}}while(e);return 0===t.length?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let i of t){let s=-1;for(;-1!==(s=i.indexOf("**",s+1));){let n=s;for(;"**"===i[n+1];)n++;n>s&&i.splice(s+1,n-s);let r=i[s+1];const o=i[s+2],a=i[s+3];if(".."!==r)continue;if(!o||"."===o||".."===o||!a||"."===a||".."===a)continue;e=!0,i.splice(s,1);const p=i.slice(0);p[s]="**",t.push(p),s--}if(!this.preserveMultipleSlashes){for(let t=1;t<i.length-1;t++){const s=i[t];1===t&&""===s&&""===i[0]||("."!==s&&""!==s||(e=!0,i.splice(t,1),t--))}"."!==i[0]||2!==i.length||"."!==i[1]&&""!==i[1]||(e=!0,i.pop())}let n=0;for(;-1!==(n=i.indexOf("..",n+1));){const t=i[n-1];if(t&&"."!==t&&".."!==t&&"**"!==t){e=!0;const t=1===n&&"**"===i[n+1]?["."]:[];i.splice(n-1,2,...t),0===i.length&&i.push(""),n-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let i=e+1;i<t.length;i++){const s=this.partsMatch(t[e],t[i],!this.preserveMultipleSlashes);if(s){t[e]=[],t[i]=s;break}}return t.filter((t=>t.length))}partsMatch(t,e,i=!1){let s=0,n=0,r=[],o="";for(;s<t.length&&n<e.length;)if(t[s]===e[n])r.push("b"===o?e[n]:t[s]),s++,n++;else if(i&&"**"===t[s]&&e[n]===t[s+1])r.push(t[s]),s++;else if(i&&"**"===e[n]&&t[s]===e[n+1])r.push(e[n]),n++;else if("*"!==t[s]||!e[n]||!this.options.dot&&e[n].startsWith(".")||"**"===e[n]){if("*"!==e[n]||!t[s]||!this.options.dot&&t[s].startsWith(".")||"**"===t[s])return!1;if("a"===o)return!1;o="b",r.push(e[n]),s++,n++}else{if("b"===o)return!1;o="a",r.push(t[s]),s++,n++}return t.length===e.length&&r}parseNegate(){if(this.nonegate)return;const t=this.pattern;let e=!1,i=0;for(let s=0;s<t.length&&"!"===t.charAt(s);s++)e=!e,i++;i&&(this.pattern=t.slice(i)),this.negate=e}matchOne(t,e,i=!1){const s=this.options;if(this.isWindows){const i="string"==typeof t[0]&&/^[a-z]:$/i.test(t[0]),s=!i&&""===t[0]&&""===t[1]&&"?"===t[2]&&/^[a-z]:$/i.test(t[3]),n="string"==typeof e[0]&&/^[a-z]:$/i.test(e[0]),r=s?3:i?0:void 0,o=!n&&""===e[0]&&""===e[1]&&"?"===e[2]&&"string"==typeof e[3]&&/^[a-z]:$/i.test(e[3])?3:n?0:void 0;if("number"==typeof r&&"number"==typeof o){const[i,s]=[t[r],e[o]];i.toLowerCase()===s.toLowerCase()&&(e[o]=i,o>r?e=e.slice(o):r>o&&(t=t.slice(r)))}}const{optimizationLevel:n=1}=this.options;n>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var r=0,o=0,a=t.length,p=e.length;r<a&&o<p;r++,o++){this.debug("matchOne loop");var l=e[o],h=t[r];if(this.debug(e,l,h),!1===l)return!1;if(l===Ee){this.debug("GLOBSTAR",[e,l,h]);var c=r,d=o+1;if(d===p){for(this.debug("** at the end");r<a;r++)if("."===t[r]||".."===t[r]||!s.dot&&"."===t[r].charAt(0))return!1;return!0}for(;c<a;){var u=t[c];if(this.debug("\nglobstar while",t,c,e,d,u),this.matchOne(t.slice(c),e.slice(d),i))return this.debug("globstar found match!",c,a,u),!0;if("."===u||".."===u||!s.dot&&"."===u.charAt(0)){this.debug("dot detected!",t,c,e,d);break}this.debug("globstar swallow a segment, and continue"),c++}return!(!i||(this.debug("\n>>> no match, partial?",t,c,e,d),c!==a))}let n;if("string"==typeof l?(n=h===l,this.debug("string match",l,h,n)):(n=l.test(h),this.debug("pattern match",l,h,n)),!n)return!1}if(r===a&&o===p)return!0;if(r===a)return i;if(o===p)return r===a-1&&""===t[r];throw new Error("wtf?")}braceExpand(){return Se(this.pattern,this.options)}parse(t){Wt(t);const e=this.options;if("**"===t)return Ee;if(""===t)return"";let i,s=null;(i=t.match(de))?s=e.dot?fe:ue:(i=t.match(ie))?s=(e.nocase?e.dot?oe:re:e.dot?ne:se)(i[1]):(i=t.match(ge))?s=(e.nocase?e.dot?me:ye:e.dot?we:ve)(i):(i=t.match(ae))?s=e.dot?le:pe:(i=t.match(he))&&(s=ce);const n=Qt.fromGlob(t,this.options).toMMPattern();return s&&"object"==typeof n&&Reflect.defineProperty(n,"test",{value:s}),n}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const t=this.set;if(!t.length)return this.regexp=!1,this.regexp;const e=this.options,i=e.noglobstar?"[^/]*?":e.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",s=new Set(e.nocase?["i"]:[]);let n=t.map((t=>{const e=t.map((t=>{if(t instanceof RegExp)for(const e of t.flags.split(""))s.add(e);return"string"==typeof t?t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):t===Ee?Ee:t._src}));return e.forEach(((t,s)=>{const n=e[s+1],r=e[s-1];t===Ee&&r!==Ee&&(void 0===r?void 0!==n&&n!==Ee?e[s+1]="(?:\\/|"+i+"\\/)?"+n:e[s]=i:void 0===n?e[s-1]=r+"(?:\\/|"+i+")?":n!==Ee&&(e[s-1]=r+"(?:\\/|\\/"+i+"\\/)"+n,e[s+1]=Ee))})),e.filter((t=>t!==Ee)).join("/")})).join("|");const[r,o]=t.length>1?["(?:",")"]:["",""];n="^"+r+n+o+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...s].join(""))}catch(a){this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return""===t;if("/"===t&&e)return!0;const i=this.options;this.isWindows&&(t=t.split("\\").join("/"));const s=this.slashSplit(t);this.debug(this.pattern,"split",s);const n=this.set;this.debug(this.pattern,"set",n);let r=s[s.length-1];if(!r)for(let o=s.length-2;!r&&o>=0;o--)r=s[o];for(let o=0;o<n.length;o++){const t=n[o];let a=s;i.matchBase&&1===t.length&&(a=[r]);if(this.matchOne(a,t,e))return!!i.flipNegate||!this.negate}return!i.flipNegate&&this.negate}static defaults(t){return ee.defaults(t).Minimatch}}function Pe(t){const e=new Set([t.id?"id":void 0,t.title?"title":void 0,...Object.keys(t).sort()].filter(Boolean));return Array.from(e)}ee.AST=Qt,ee.Minimatch=je,ee.escape=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/[?*()[\]]/g,"[$&]"):t.replace(/[?*()[\]\\]/g,"\\$&"),ee.unescape=Ht;const Re=(t,e)=>{let i;return{collection:Object.values(e).find((e=>{if(!e.source||0===e.source.length)return;const s=Et(t);return("/"===s?["index.yml","index.yaml","index.md","index.json"]:[s]).some((t=>(i=e.source.find((e=>{var i;const s=ee(t,e.include),n=null==(i=e.exclude)?void 0:i.some((e=>ee(t,e)));return s&&!n})),i)))})),matchedSource:i}};function Me(t,e){const i=function(t,e){const i=[],s=t.schema.definitions[t.name].properties;return Pe(s).forEach((n=>{const r=s[n],o=t.fields[n],a=void 0!==r.default?r.default:"NULL",p=void 0!==e[n]?e[n]:a;"json"===o?i.push(`'${JSON.stringify(p).replace(/'/g,"''")}'`):"string"===o||["string","enum"].includes(r.type)?["data","datetime"].includes(r.format)?i.push("NULL"!==p?`'${new Date(p).toISOString()}'`:a):i.push(`'${String(p).replace(/\n/g,"\\n").replace(/'/g,"''")}'`):"boolean"===o?i.push("NULL"!==p?!!p:p):i.push(p)})),i.push(`'${ot(i)}'`),i}(t,e);let s=0;return`INSERT INTO ${t.tableName} VALUES (${"?, ".repeat(i.length).slice(0,-2)})`.replace(/\?/g,(()=>i[s++]))}function $e(t,e){return`DELETE FROM ${t.tableName} WHERE stem = '${e}';`}function Oe(t,e,i){return`SELECT * FROM ${t.tableName} WHERE ${e} = '${i}';`}const ke=["https://nuxt.studio","https://dev.nuxt.studio"],Ce={introduction:{name:"introduction",pascalName:"Introduction",tableName:"_content_introduction",source:[{_resolved:!0,prefix:"/get-started",include:"get-started/**",cwd:"/home/runner/work/nuxt-app/nuxt-app/content"}],type:"page",fields:{id:"string",stem:"string",extension:"string",meta:"json",path:"string",title:"string",description:"string",seo:"json",body:"json",navigation:"json"},schema:{$ref:"#/definitions/introduction",definitions:{introduction:{type:"object",properties:{id:{type:"string"},stem:{type:"string"},extension:{type:"string",enum:["md","yaml","yml","json","csv","xml"]},meta:{type:"object",additionalProperties:{}},path:{type:"string"},title:{type:"string"},description:{type:"string"},seo:{allOf:[{type:"object",properties:{title:{type:"string"},description:{type:"string"}}},{type:"object",additionalProperties:{}}],default:{}},body:{type:"object",properties:{type:{type:"string"},children:{},toc:{}},required:["type"],additionalProperties:!1},navigation:{anyOf:[{type:"boolean"},{type:"object",properties:{title:{type:"string"},description:{type:"string"},icon:{type:"string"}},required:["title","description","icon"],additionalProperties:!1}],default:!0}},required:["id","stem","extension","meta","path","title","description","body"],additionalProperties:!1}},$schema:"http://json-schema.org/draft-07/schema#"},tableDefinition:'CREATE TABLE IF NOT EXISTS _content_introduction (id TEXT PRIMARY KEY, "title" VARCHAR, "body" TEXT, "description" VARCHAR, "extension" VARCHAR, "meta" TEXT, "navigation" TEXT DEFAULT true, "path" VARCHAR, "seo" TEXT DEFAULT \'{}\', "stem" VARCHAR, "__hash__" TEXT UNIQUE);'},payments:{name:"payments",pascalName:"Payments",tableName:"_content_payments",source:[{_resolved:!0,prefix:"/payments",include:"payments/**",cwd:"/home/runner/work/nuxt-app/nuxt-app/content"}],type:"page",fields:{id:"string",stem:"string",extension:"string",meta:"json",path:"string",title:"string",description:"string",seo:"json",body:"json",navigation:"json"},schema:{$ref:"#/definitions/payments",definitions:{payments:{type:"object",properties:{id:{type:"string"},stem:{type:"string"},extension:{type:"string",enum:["md","yaml","yml","json","csv","xml"]},meta:{type:"object",additionalProperties:{}},path:{type:"string"},title:{type:"string"},description:{type:"string"},seo:{allOf:[{type:"object",properties:{title:{type:"string"},description:{type:"string"}}},{type:"object",additionalProperties:{}}],default:{}},body:{type:"object",properties:{type:{type:"string"},children:{},toc:{}},required:["type"],additionalProperties:!1},navigation:{anyOf:[{type:"boolean"},{type:"object",properties:{title:{type:"string"},description:{type:"string"},icon:{type:"string"}},required:["title","description","icon"],additionalProperties:!1}],default:!0}},required:["id","stem","extension","meta","path","title","description","body"],additionalProperties:!1}},$schema:"http://json-schema.org/draft-07/schema#"},tableDefinition:'CREATE TABLE IF NOT EXISTS _content_payments (id TEXT PRIMARY KEY, "title" VARCHAR, "body" TEXT, "description" VARCHAR, "extension" VARCHAR, "meta" TEXT, "navigation" TEXT DEFAULT true, "path" VARCHAR, "seo" TEXT DEFAULT \'{}\', "stem" VARCHAR, "__hash__" TEXT UNIQUE);'},content:{name:"content",pascalName:"Content",tableName:"_content_content",source:[{_resolved:!0,prefix:"/",include:"**",cwd:"/home/runner/work/nuxt-app/nuxt-app/content"}],type:"page",fields:{id:"string",stem:"string",extension:"string",meta:"json",path:"string",title:"string",description:"string",seo:"json",body:"json",navigation:"json"},schema:{$ref:"#/definitions/content",definitions:{content:{type:"object",properties:{id:{type:"string"},stem:{type:"string"},extension:{type:"string",enum:["md","yaml","yml","json","csv","xml"]},meta:{type:"object",additionalProperties:{}},path:{type:"string"},title:{type:"string"},description:{type:"string"},seo:{allOf:[{type:"object",properties:{title:{type:"string"},description:{type:"string"}}},{type:"object",additionalProperties:{}}],default:{}},body:{type:"object",properties:{type:{type:"string"},children:{},toc:{}},required:["type"],additionalProperties:!1},navigation:{anyOf:[{type:"boolean"},{type:"object",properties:{title:{type:"string"},description:{type:"string"},icon:{type:"string"}},required:["title","description","icon"],additionalProperties:!1}],default:!0}},required:["id","stem","extension","meta","path","title","description","body"],additionalProperties:!1}},$schema:"http://json-schema.org/draft-07/schema#"},tableDefinition:'CREATE TABLE IF NOT EXISTS _content_content (id TEXT PRIMARY KEY, "title" VARCHAR, "body" TEXT, "description" VARCHAR, "extension" VARCHAR, "meta" TEXT, "navigation" TEXT DEFAULT true, "path" VARCHAR, "seo" TEXT DEFAULT \'{}\', "stem" VARCHAR, "__hash__" TEXT UNIQUE);'},info:{name:"info",pascalName:"Info",tableName:"_content_info",source:[],type:"data",fields:{},schema:{$ref:"#/definitions/info",definitions:{info:{type:"object",properties:{id:{type:"string"},version:{type:"string"},structureVersion:{type:"string"},ready:{type:"boolean"}},required:["id","version","structureVersion","ready"],additionalProperties:!1}},$schema:"http://json-schema.org/draft-07/schema#"},tableDefinition:'CREATE TABLE IF NOT EXISTS _content_info (id TEXT PRIMARY KEY, "ready" BOOLEAN, "structureVersion" VARCHAR, "version" VARCHAR, "__hash__" TEXT UNIQUE);'}},Ne=R(!1),Le=(t=>{let e;return i=>(e||(e=t()),e)})((()=>JSON.parse(JSON.stringify(Y())))),We=async t=>{const e=function(t=[],e,i){const s=[...e||[]],n=[...i||[]],r=JSON.parse(JSON.stringify(t));for(const a of s)if(a.new)r.push({path:a.path,parsed:a.parsed});else if(a.oldPath)if(n.splice(n.findIndex((t=>t.path===a.oldPath)),1),s.find((t=>t.path===a.oldPath)))r.push({path:a.path,parsed:a.parsed});else{const t=r.find((t=>t.path===a.oldPath));t&&(t.path=a.path,a.parsed?t.parsed=a.parsed:a.pathMeta&&["_file","_path","_id","_locale"].forEach((e=>{t.parsed[e]=a.pathMeta[e]})))}else{const t=r.find((t=>t.path===a.path));t?Object.assign(t,{path:a.path,parsed:a.parsed}):r.push({path:a.path,parsed:a.parsed})}for(const a of n)r.splice(r.findIndex((t=>t.path===a.path)),1);const o=new Intl.Collator(void 0,{numeric:!0});return r.sort(((t,e)=>o.compare(t.path,e.path))),r}(t.files,t.additions,t.deletions),i=e.filter((t=>![xt.appConfig,xt.appConfigV4,xt.nuxtConfig].includes(t.path)));for(const n of Object.values(Ce)){const t=Q(n.name);await t.exec(n.tableDefinition)}for(const n of i)await Ie(Ce,n);const s=e.find((t=>[xt.appConfig,xt.appConfigV4].includes(t.path)));s&&Be(s.parsed),tt(),Ne.value=!0},Ie=async(t,e)=>{const{collection:i,matchedSource:s}=Re(e.path,t);if(!i||!s)return void console.warn(`Content Preview: collection not found for file: ${e.path}, skipping insertion.`);const n=Q(i.name),r=Me(i,Mt(e,i,s));await n.exec(r)},Be=t=>{const e=j(),i=J(e,Y);Pt(i,Tt(t||{},Le)),t||jt(i,Le)};function ze(){const t=K().public.preview||{},e=window.sessionStorage.getItem("previewToken"),i=document.createElement("div");i.id="__nuxt_preview_wrapper",document.body.appendChild(i),Z(ht,{previewToken:e,api:window.sessionStorage.getItem("previewAPI")||(null==t?void 0:t.api),initializePreview:We}).mount(i)}function Ve(){const t=j(),e=K().public.preview;if(!window.parent||window.self===window.parent)return;const i=P(),s=G();async function n(){if(!Ne.value)return;const t=s.path,{collection:e}=((t,e)=>{let i;return{collection:Object.values(e).find((e=>{if(e.source&&0!==e.source.length)return i=e.source.find((e=>{var i;if(!e.prefix)return;const s=At(e.prefix,!0);if(!t.startsWith(s))return;if("/"===t){const i=["index.yml","index.yaml","index.md","index.json"];return("/"===t?i:i.map((t=>X(F(s,t))))).some((t=>{var i;const s=ee(t,At(e.include)),n=null==(i=e.exclude)?void 0:i.some((e=>ee(t,At(e))));return s&&!n}))}const{fixed:n}=Rt(e),r=At(n||""),o=t.substring(s.length),a=F(r,o),p=t=>t.replace(/\.[^/.]+$/,""),l=ee(a,p(At(e.include))),h=null==(i=e.exclude)?void 0:i.some((t=>ee(a,p(At(t)))));return l&&!h})),i})),matchedSource:i}})(t,Ce);if(!e||"page"!==e.type)return void window.sendNavigateMessageInPreview(t,!1);const i=Q(e.name),n=Oe(e,"path",t),r=await i.first(n);window.sendNavigateMessageInPreview(t,!!(null==r?void 0:r.path))}window.addEventListener("keydown",(t=>{(t.metaKey||t.ctrlKey||t.altKey||t.shiftKey)&&window.parent.postMessage({type:"nuxt-content:preview:keydown",payload:{key:t.key,metaKey:t.metaKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey}},"*")})),window.addEventListener("message",(async t=>{var n;if(!Ne.value)return;const r=(null==(n=null==e?void 0:e.iframeMessagingAllowedOrigins)?void 0:n.split(",").map((t=>t.trim())))||[];if(!["http://localhost:3000",...ke,...r].includes(t.origin))return;const{type:o,payload:a={},navigate:p}=t.data||{};switch(o){case"nuxt-content:editor:file-selected":await async function(t){if(!t)return;const{collection:e}=Re(Et(t),Ce);if(!e)return void console.warn(`Content Preview: collection not found for file: ${t}, skipping navigation.`);if("page"!==e.type)return;const n=Q(e.name),r=St(t),o=Oe(e,"stem",r),a=await n.first(o);if(!a||!a.path)return;const p=i.resolve(a.path);if(!p||!p.matched||0===p.matched.length)return;a.path!==s.path&&i.push(a.path)}(a.path);break;case"nuxt-content:editor:file-changed":case"nuxt-content:editor:media-changed":{const{additions:t=[],deletions:e=[]}=a;for(const i of t)await l(i,p);for(const i of e)await h(i.path);!async function(){await j().hooks.callHookParallel("app:data:refresh")}();break}case"nuxt-content:config:file-changed":{const{additions:t=[],deletions:e=[]}=a,i=t.find((t=>[xt.appConfig,xt.appConfigV4].includes(t.path)));i&&Be(null==i?void 0:i.parsed);e.find((t=>[xt.appConfig,xt.appConfigV4].includes(t.path)))&&Be(void 0)}}async function l(t,e){const{collection:n,matchedSource:r}=Re(t.path,Ce);if(!n||!r)return void console.warn(`Content Preview: collection not found for file: ${t.path}, skipping update.`);const o=function(t,e,i){return`${$e(t,e)}; ${Me(t,i)}`}(n,St(t.path),Mt({path:t.path,parsed:t.parsed},n,r)),a=Q(n.name);if(await a.exec(o),"page"!==n.type||!t.pathRoute)return;const p=q(t.pathRoute);if(e&&p!==s.path){const t=i.resolve(p);if(!t||!t.matched||0===t.matched.length)return;i.push(p)}}async function h(t){const{collection:e}=Re(Et(t),Ce);if(!e)return void console.warn(`Content Preview: collection not found for file: ${t}, skipping deletion.`);const i=$e(e,St(t)),s=Q(e.name);await s.exec(i)}})),t.hook("page:finish",(()=>{n()})),t.hook("nuxt-content:preview:ready",(()=>{window.parent.postMessage({type:"nuxt-content:preview:ready"},"*")})),window.sendNavigateMessageInPreview=(t,e)=>{window.parent.postMessage({type:"nuxt-content:preview:navigate",payload:{path:t,navigate:e}},"*")}}export{Ve as initIframeCommunication,ze as mountPreviewUI};
